<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FPS COD-style Map</title>
<style>
body { margin:0; overflow:hidden; background:#111; }
#hud {
  position:fixed; bottom:20px; left:20px;
  color:white; font-family:Arial; font-size:18px;
}
</style>
</head>
<body>
<div id="hud">HP: <span id="hp">100</span></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene, camera, renderer, controls;
let bots = [];
let playerHP = 100;
const hpUI = document.getElementById("hp");
const BOT_COUNT = 10;

///////////////////////
// INIT SCENE
///////////////////////
function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87CEEB); // sky blue

  // Camera
  camera = new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth,innerHeight);
  document.body.appendChild(renderer.domElement);

  // Lighting
  scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));
  const sun = new THREE.DirectionalLight(0xffffff,0.6);
  sun.position.set(20,50,20);
  scene.add(sun);

  // Controls
  controls = new THREE.PointerLockControls(camera, document.body);
  document.body.onclick=()=>controls.lock();
  scene.add(controls.getObject());

  ///////////////////////////
  // MAP - COD STYLE
  ///////////////////////////
  // Floor
  const floorTex = new THREE.MeshStandardMaterial({color:0x555555});
  const floor = new THREE.Mesh(new THREE.PlaneGeometry(200,200), floorTex);
  floor.rotation.x=-Math.PI/2;
  scene.add(floor);

  // Buildings (like COD maps)
  const wallMat = new THREE.MeshStandardMaterial({color:0x999999});
  function wall(x,z,w,h,d){
    const b = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), wallMat);
    b.position.set(x,h/2,z);
    scene.add(b);
    return b;
  }
  // Central street
  wall(0,0,200,4,4); // start line wall
  wall(-50,-50,20,6,20); // building 1
  wall(50,-50,20,6,20); // building 2
  wall(-50,50,20,6,20); // building 3
  wall(50,50,20,6,20); // building 4
  wall(0,50,40,6,40); // mid cover
  wall(0,-50,40,6,40); // mid cover

  // Boxes / cover
  function box(x,z,w,h,d){
    const b = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), wallMat);
    b.position.set(x,h/2,z);
    scene.add(b);
  }
  box(-20,0,5,3,5);
  box(20,0,5,3,5);
  box(0,-20,5,3,5);
  box(0,20,5,3,5);

  ///////////////////////////
  // GUN
  ///////////////////////////
  const gun = new THREE.Mesh(new THREE.BoxGeometry(0.3,0.2,1), new THREE.MeshStandardMaterial({color:0x222222}));
  gun.position.set(0.3,-0.3,-1);
  camera.add(gun);

  ///////////////////////////
  // BOTS
  ///////////////////////////
  bots=[];
  for(let i=0;i<BOT_COUNT;i++){
    const color = Math.random()>0.5?0x44ff44:0x4444ff;
    const bot = new THREE.Mesh(new THREE.CapsuleGeometry(1,2), new THREE.MeshStandardMaterial({color}));
    bot.position.set(Math.random()*80-40,2,Math.random()*80-40);
    bot.hp=100;
    bot.cool=Math.floor(Math.random()*100);
    bot.target=new THREE.Vector3(bot.position.x,2,bot.position.z);
    scene.add(bot);
    bots.push(bot);
  }

  ///////////////////////////
  // CONTROLS & INPUT
  ///////////////////////////
  const keys={};
  addEventListener("keydown", e=>keys[e.code]=true);
  addEventListener("keyup", e=>keys[e.code]=false);

  const raycaster = new THREE.Raycaster();
  addEventListener("mousedown", ()=>{
    gun.position.z-=0.1;
    setTimeout(()=>gun.position.z+=0.1,60);
    raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
    const hits = raycaster.intersectObjects(bots);
    if(hits.length){
      const b = hits[0].object;
      b.hp-=40;
      if(b.hp<=0){
        scene.remove(b);
        bots.splice(bots.indexOf(b),1);
      }
    }
  });

  ///////////////////////////
  // GAME LOOP
  ///////////////////////////
  function animate(){
    requestAnimationFrame(animate);

    const speed=0.15;
    if(keys.KeyW) controls.moveForward(speed);
    if(keys.KeyS) controls.moveForward(-speed);
    if(keys.KeyA) controls.moveRight(-speed);
    if(keys.KeyD) controls.moveRight(speed);

    // Bots AI
    bots.forEach(bot=>{
      if(Math.random()<0.01) bot.target.set(Math.random()*80-40,2,Math.random()*80-40);
      bot.position.lerp(bot.target,0.003);

      const dist = bot.position.distanceTo(camera.position);
      if(dist<25 && bot.cool<=0){
        playerHP-=5;
        hpUI.textContent=playerHP;
        bot.cool=60;
        if(playerHP<=0){alert("You died!"); location.reload();}
      }
      bot.cool--;

      // Bots shoot each other for fake multiplayer
      bots.forEach(other=>{
        if(bot===other) return;
        if(Math.random()<0.002){
          const d=bot.position.distanceTo(other.position);
          if(d<20){
            other.hp-=5;
            if(other.hp<=0){
              scene.remove(other);
              bots.splice(bots.indexOf(other),1);
            }
          }
        }
      });
    });

    renderer.render(scene,camera);
  }
  animate();
}

init();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
