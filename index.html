<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Simple FPS</title>
<style>
body { margin:0; overflow:hidden; background:#000; }
#hud {
  position:fixed; bottom:20px; left:20px;
  color:white; font-family:Arial; font-size:18px;
}
</style>
</head>
<body>
<div id="hud">HP: <span id="hp">100</span></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene, camera, renderer, controls;
let bot;
let playerHP = 100;
const hpUI = document.getElementById("hp");

function init() {
    // Scene
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x800080); // purple sky

    // Camera
    camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
    camera.position.set(0,1.6,5);

    // Renderer
    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(innerWidth, innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lights
    const hemi = new THREE.HemisphereLight(0xffffff,0x444444,1);
    scene.add(hemi);
    const sun = new THREE.DirectionalLight(0xffffff,0.8);
    sun.position.set(50,50,50);
    scene.add(sun);

    // Controls
    controls = new THREE.PointerLockControls(camera, document.body);
    document.body.onclick = ()=>controls.lock();
    scene.add(controls.getObject());

    // Floor
    const floorMat = new THREE.MeshStandardMaterial({color:0x555555});
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(100,100), floorMat);
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // Building (cover)
    const building = new THREE.Mesh(
        new THREE.BoxGeometry(10,10,10),
        new THREE.MeshStandardMaterial({color:0x999999})
    );
    building.position.set(0,5,0);
    scene.add(building);

    // Gun
    const gun = new THREE.Mesh(
        new THREE.BoxGeometry(0.3,0.2,1),
        new THREE.MeshStandardMaterial({color:0x222222})
    );
    gun.position.set(0.3,-0.3,-1);
    camera.add(gun);

    // Bot
    bot = new THREE.Mesh(
        new THREE.CapsuleGeometry(1,2),
        new THREE.MeshStandardMaterial({color:0x44ff44})
    );
    bot.position.set(0,1, -20);
    scene.add(bot);
    bot.hp = 100;
    bot.direction = 1; // moves back and forth

    // Input
    const keys = {};
    addEventListener("keydown", e=>keys[e.code]=true);
    addEventListener("keyup", e=>keys[e.code]=false);

    const raycaster = new THREE.Raycaster();
    addEventListener("mousedown", ()=>{
        gun.position.z -= 0.1;
        setTimeout(()=>gun.position.z += 0.1,60);
        raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
        const hits = raycaster.intersectObject(bot);
        if(hits.length){
            bot.hp -= 40;
            if(bot.hp <= 0){
                scene.remove(bot);
            }
        }
    });

    function animate(){
        requestAnimationFrame(animate);

        // Player movement
        const speed = 0.1;
        if(keys.KeyW) controls.moveForward(speed);
        if(keys.KeyS) controls.moveForward(-speed);
        if(keys.KeyA) controls.moveRight(-speed);
        if(keys.KeyD) controls.moveRight(speed);

        // Bot movement back and forth
        bot.position.z += 0.05 * bot.direction;
        if(bot.position.z > 0) bot.direction = -1;
        if(bot.position.z < -20) bot.direction = 1;

        // Bot attack player if close
        if(bot.position.distanceTo(camera.position) < 3){
            playerHP -= 0.5;
            hpUI.textContent = Math.max(Math.floor(playerHP),0);
            if(playerHP <= 0){
                alert("You died!");
                location.reload();
            }
        }

        renderer.render(scene,camera);
    }
    animate();
}

init();

addEventListener("resize", ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
